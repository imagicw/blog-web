import{j as v}from"./jsx-runtime.D_zvdyIk.js";import{r as a}from"./index.Cq4AiLjf.js";import{c as I}from"./client.os_vlCEB.js";import"./_commonjsHelpers.CqkleIqs.js";class P{x;y;size;vx;vy;baseAlpha;alpha;flashSpeed;flashDir;color;exploding;constructor(s,h,e="dark",i=1){this.x=Math.random()*s,this.y=Math.random()*h,this.size=(Math.random()*1.5+.5)*i,this.vx=(Math.random()-.5)*.2,this.vy=(Math.random()-.5)*.2,this.baseAlpha=Math.random()*.5+.3,this.alpha=this.baseAlpha,this.flashSpeed=Math.random()*.02+.005,this.flashDir=1,this.color=e==="dark"?[200,200,200]:[80,80,80],this.exploding=!1}update(s,h,e){if(e){if(!this.exploding){const i=Math.random()*Math.PI*2,n=Math.random()*5+2;this.vx=Math.cos(i)*n,this.vy=Math.sin(i)*n,this.exploding=!0}this.x+=this.vx,this.y+=this.vy,this.alpha-=.03,this.size*=.95}else this.x+=this.vx,this.y+=this.vy,this.x<0&&(this.x=s),this.x>s&&(this.x=0),this.y<0&&(this.y=h),this.y>h&&(this.y=0),this.alpha+=this.flashSpeed*this.flashDir,(this.alpha>=this.baseAlpha+.2||this.alpha<=this.baseAlpha-.2)&&(this.flashDir*=-1),this.alpha=Math.max(0,Math.min(1,this.alpha))}draw(s){this.alpha<=.01||(s.beginPath(),s.fillStyle=`rgba(${this.color[0]}, ${this.color[1]}, ${this.color[2]}, ${this.alpha})`,s.arc(this.x,this.y,this.size,0,Math.PI*2),s.fill())}}const j=({children:p,theme:s,density:h=.4})=>{const[e,i]=a.useState(!1),[n,g]=a.useState(!1),[c,d]=a.useState("dark"),[k,L]=a.useState(!1),E=a.useRef(null),w=a.useRef(null),u=a.useRef(null),m=a.useRef([]);a.useEffect(()=>{const t=navigator.userAgent,r=/^((?!chrome|android).)*safari/i.test(t);L(r)},[]),a.useEffect(()=>{if(s){d(s);return}const t=()=>{const o=document.documentElement.classList.contains("dark");d(o?"dark":"light")};t();const r=o=>{d(o.detail?.theme||"dark")};window.addEventListener("theme-change",r);const f=new MutationObserver(o=>{o.forEach(M=>{M.attributeName==="class"&&t()})});return f.observe(document.documentElement,{attributes:!0}),()=>{window.removeEventListener("theme-change",r),f.disconnect()}},[s]),a.useEffect(()=>{if(!e&&n){g(!1);return}if(n)return;const t=E.current,r=w.current;if(!t||!r)return;const f=t.getContext("2d"),o=()=>{r&&t&&(t.width=r.offsetWidth,t.height=r.offsetHeight,(!e||m.current.length===0)&&M())},M=()=>{if(!t)return;m.current=[];const x=t.width*t.height;let l=Math.floor(x*h/10);const S=2500;let b=1;if(l>S){const y=l/S;l=S,b=Math.sqrt(y),b=Math.min(b,4)}for(let y=0;y<l;y++)m.current.push(new P(t.width,t.height,c,b))};!e&&m.current.length===0&&o(),o();const A=new ResizeObserver(()=>{o()});A.observe(r);const R=()=>{if(!f||!t)return;f.clearRect(0,0,t.width,t.height);let x=0;m.current.forEach(l=>{l.update(t.width,t.height,e),l.draw(f),l.alpha>0&&x++}),e&&x===0?(g(!0),u.current&&(cancelAnimationFrame(u.current),u.current=null)):u.current=requestAnimationFrame(R)};return R(),()=>{A.disconnect(),u.current&&cancelAnimationFrame(u.current)}},[e,n,c,h]);const z=t=>{t.stopPropagation(),t.preventDefault(),i(!e)};return v.jsxs("span",{ref:w,onClick:z,className:"relative inline-block align-middle rounded-md overflow-hidden transition-all duration-300 cursor-pointer select-none group",style:{verticalAlign:"bottom"},children:[v.jsx("span",{style:{opacity:e?1:0,visibility:e?"visible":"hidden",color:e?"inherit":"transparent",transition:k&&!e?"none":"opacity 0.5s, visibility 0.5s, color 0.5s",pointerEvents:e?"auto":"none",userSelect:e?"auto":"none"},children:p}),!n&&v.jsx("canvas",{ref:E,className:"absolute top-0 left-0 w-full h-full pointer-events-none z-10",style:{transform:"translateZ(0)",WebkitBackfaceVisibility:"hidden"}})]})},$=()=>(a.useEffect(()=>{const p=()=>{document.querySelectorAll(".spoiler").forEach(e=>{const i=e;if(i.dataset.reactSpoilerInitialized)return;i.dataset.reactSpoilerInitialized="true";const n=i.innerHTML;i.innerHTML="",i.classList.remove("spoiler");const g=I.createRoot(i),c=i.getAttribute("data-theme");let d;(c==="dark"||c==="light")&&(d=c),g.render(v.jsx(j,{theme:d,children:v.jsx("span",{dangerouslySetInnerHTML:{__html:n}})}))})};p();const s=()=>{p()};return document.addEventListener("astro:page-load",s),()=>{document.removeEventListener("astro:page-load",s)}},[]),null);export{$ as default};
